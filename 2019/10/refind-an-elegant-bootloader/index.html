<!doctype html><html lang=en-us data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>rEFInd: An elegant bootloader - manueljimenezs</title><meta name=description content="Introduction     From the year 2013, Microsoft switched its operating system&rsquo;s booting mode to a technology called EFI, already being used in Macs for a long time.
In UEFI (The PC implementation) multiple applications can coexist, this means you can combine multiple bootloaders such as Windows Boot, GRUB, systemd-boot without taking over each other.
EFI Requirements      Your motherboard has to be supported (>2013) Your disk has to be formatted in GPT instead of MBR You need an ESP (EFI system partition) that stores all the bootable executables  The ESP     The ESP (EFI system partition) is a small FAT32 partition (~512MB) that stores all the bootloaders:"><link rel=icon type=image/x-icon href=favicon.ico><link rel=apple-touch-icon-precomposed href=favicon.png><style>body{visibility:hidden;opacity:0}</style><noscript><style>body{visibility:visible;opacity:1}</style></noscript><link rel=stylesheet href=/css/style.min.0b964cc5cfe9ae8b741482fda65fc475aa83d02b3d6aff4335e95f752a8df29f.css integrity="sha256-C5ZMxc/prot0FIL9pl/EdaqD0Cs9av9DNelfdSqN8p8="><script src=/js/script.min.a65afe903825231554d9b55b073eb144da4ccf2d2823b216dcbc6cc656c9de76.js type=text/javascript integrity="sha256-plr+kDglIxVU2bVbBz6xRNpMzy0oI7IW3LxsxlbJ3nY="></script><meta property="og:title" content="rEFInd: An elegant bootloader"><meta property="og:description" content="Introduction     From the year 2013, Microsoft switched its operating system&rsquo;s booting mode to a technology called EFI, already being used in Macs for a long time.
In UEFI (The PC implementation) multiple applications can coexist, this means you can combine multiple bootloaders such as Windows Boot, GRUB, systemd-boot without taking over each other.
EFI Requirements      Your motherboard has to be supported (>2013) Your disk has to be formatted in GPT instead of MBR You need an ESP (EFI system partition) that stores all the bootable executables  The ESP     The ESP (EFI system partition) is a small FAT32 partition (~512MB) that stores all the bootloaders:"><meta property="og:type" content="article"><meta property="og:url" content="/2019/10/refind-an-elegant-bootloader/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-10-29T20:39:54+01:00"><meta property="article:modified_time" content="2019-10-29T20:39:54+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="rEFInd: An elegant bootloader"><meta name=twitter:description content="Introduction     From the year 2013, Microsoft switched its operating system&rsquo;s booting mode to a technology called EFI, already being used in Macs for a long time.
In UEFI (The PC implementation) multiple applications can coexist, this means you can combine multiple bootloaders such as Windows Boot, GRUB, systemd-boot without taking over each other.
EFI Requirements      Your motherboard has to be supported (>2013) Your disk has to be formatted in GPT instead of MBR You need an ESP (EFI system partition) that stores all the bootable executables  The ESP     The ESP (EFI system partition) is a small FAT32 partition (~512MB) that stores all the bootloaders:"></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><span class=site-logo><a href=/><svg height="24" viewBox="0 0 655 389" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2"><g id="layer1" transform="matrix(1,0,0,1,730.269,231.964)"><path id="path890" d="M-531.765-231.962C-532.739-231.955-533.717-231.932-534.694-231.89V-231.888C-564.056-230.636-590.585-214.002-604.5-188.117-618.414-162.231-617.657-130.927-602.504-105.745l32.078 55.058C-570.476-50.698-570.517-50.717-570.566-50.728c15.383 34.082-12.39 57.859-41.326 48.316C-622.593-7.084-635.12-10.49-647.416-10.525-693.175-10.525-730.269 26.572-730.269 72.332c0 45.76 37.0940000000001 82.857 82.853 82.858C-607.774 155.179-573.695 127.087-566.115 88.176c7-37.986 56.139-38.436 68.289-14.037L-497.713 74.109l22.422 38.486c22.838 40.422 74.318 54.365 114.433 30.992 40.114-23.372 53.372-75.035 29.469-114.836l-32.857-56.396C-374.139-55.314-339.589-67.769-326.721-50.702l95.268 165.01c22.65 40.566 74.114 54.753 114.351 31.524 40.238-23.229 53.686-74.891 29.883-114.791L-214.438-189.301c-15.28-27.351-44.617-43.811-75.924-42.6C-323.078-230.588-350.056-209.372-364.246-179.864-373.238-161.166-390.741-155.566-408.834-155.553-425.341-155.561-440.693-163.221-450.645-175.934L-458.602-189.59c-14.908-26.437-42.966-42.601-73.162-42.371L-531.765-231.962z" style="fill-rule:nonzero"/></g></svg></a></span><ul class=social-icons></ul><nav><input type=checkbox id=nav-trigger class=nav-trigger>
<label for=nav-trigger><span class=menu-icon><svg viewBox="0 0 18 15" width="18" height="15"><path d="M18 1.484c0 .82-.665 1.484-1.484 1.484H1.484C.665 2.969.0 2.304.0 1.484.0.665.665.0 1.484.0h15.032C17.335.0 18 .665 18 1.484zm0 6.032C18 8.335 17.335 9 16.516 9H1.484C.665 9 0 8.335.0 7.516c0-.82.665-1.484 1.484-1.484h15.032C17.335 6.031 18 6.696 18 7.516zm0 6C18 14.335 17.335 15 16.516 15H1.484C.665 15 0 14.335.0 13.516c0-.82.665-1.483 1.484-1.483h15.032C17.335 12.031 18 12.695 18 13.516z"/></svg></span></label><div class=trigger><a href=/tags/ title>Tags</a>
<a href=/archive/ title>Archive</a></div></nav></div></header><main id=main tabindex=-1><article class="post h-entry"><div class=post-header><header><h1 class="p-name post-title">rEFInd: An elegant bootloader</h1></header></div><div class="content e-content"><p><img src=/img/refind_scr.png alt="Refind Bootloader"></p><h1 id=introduction>Introduction
<span><a href=#introduction><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h1><p>From the year 2013, Microsoft switched its operating system&rsquo;s booting mode to a technology called EFI, already being used in Macs for a long time.</p><p>In UEFI (The PC implementation) multiple applications can coexist, this means you can combine multiple bootloaders such as Windows Boot, GRUB, systemd-boot without taking over each other.</p><h1 id=efi-requirements>EFI Requirements
<span><a href=#efi-requirements><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h1><ul><li>Your motherboard has to be supported (>2013)</li><li>Your disk has to be formatted in GPT instead of MBR</li><li>You need an ESP (EFI system partition) that stores all the <em>bootable</em> executables</li></ul><h2 id=the-esp>The ESP
<span><a href=#the-esp><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>The ESP (EFI system partition) is a small FAT32 partition (~512MB) that stores all the bootloaders:</p><pre tabindex=0><code>.
├── Boot
│   ├── BOOT.CSV
│   ├── bootx64.efi
│   └── ref.bak
├── Microsoft
│   ├── Boot
│   └── Recovery
├── refind
│   ├── BOOT.CSV
│   ├── drivers_x64
│   ├── icons
│   ├── keys
│   ├── refind.conf
│   ├── refind.conf.bak
│   ├── refind_x64.efi
│   └── themes
├── tools
└── ubuntu
    ├── fw
    └── fwupx64.efi
</code></pre><p>The default bootloader is stored in the firmware level in something we call <em>EFI Variables</em> that we&rsquo;ll configure in just a moment. In some motherboards the default bootloader can be chosen in the motherboard config screen.</p><p>The <code>Boot</code> directory is a fallback option just in case those variables are not set, you could copy any <code>.efi</code> file in other folder to <code>bootx64.efi</code> to make it your fallback option.</p><h1 id=refind>rEFInd
<span><a href=#refind><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h1><p>rEFInd is a graphic bootloader that is smart enough to find the bootable entries without much configuration, it is also able to remember the last booted option to be selected on the next boot. It is also able to boot USB sticks and be bootable from any install media.</p><h2 id=manual-install>Manual install
<span><a href=#manual-install><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>Supposing you have an ESP partition in a GPT disk (If you are using Windows 10, you probably are) you just have to copy <a href=https://sourceforge.net/projects/refind/files/0.11.4/refind-bin-0.11.4.zip/download>the refind folder</a> into the /EFI folder of the ESP (There are also OS-specific installers that do this)</p><p>Once copied you have to tell your motherboard to boot from it by default.</p><p>In Linux there is an utility that list the boot order called <code>efibootmgr</code></p><pre tabindex=0><code>BootCurrent: 0002
Timeout: 1 seconds
BootOrder: 0002,0000,0006,0001,0003,0004
Boot0000* Windows Boot Manager
Boot0001* UEFI:CD/DVD Drive
Boot0002* rEFInd Boot Manager
Boot0003* UEFI:Removable Device
Boot0004* UEFI:Network Device
Boot0006* proxmox
</code></pre><p>To add rEFInd:</p><p><code>efibootmgr -c -l \\EFI\\refind\\refind_x64.efi -L rEFInd</code></p><p>To change the boot order:</p><p><code>efibootmgr -o 0,1,2</code></p><p>To remove an entry:</p><p><code>efibootmgr -Bb 0000</code></p><p>Refind has a <code>refind.conf</code> and lots of themes to customize it.</p><h2 id=adding-linux>Adding Linux
<span><a href=#adding-linux><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><p>Windows is automatically detected by refind and some Linux distros too, but if you want to be sure add a <code>refind_linux.conf</code> file into your Linux Partition in the <code>/boot/</code> directory:</p><pre tabindex=0><code>&#34;Boot using default options&#34;     &#34;root=PARTUUID=a9fbd673-2ba9-4dcd-be6b-97423dd74c89 rw initrd=/boot/amd-ucode.img initrd=/boot/initramfs-%v.img&#34;
</code></pre><p>the root points to the ID of the partition in which the distro is installed, it can be retrieved with <code>blkid</code>.</p><h2 id=extra-ubuntu-copying-kernels-to-esp>Extra: Ubuntu: Copying kernels to ESP
<span><a href=#extra-ubuntu-copying-kernels-to-esp><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg></a></span></h2><pre tabindex=0><code>manu@x240:~$ cat /etc/kernel/postinst.d/zz-kernel-esp 
#!/bin/bash
#
# This is a simple custom kernel hook to populate the systemd-boot entries
# whenever kernels are added or removed during an update.
#

vmlinuz=$(find /boot -maxdepth 1 -name &#34;vmlinuz-*-generic&#34;)
version=$(echo $vmlinuz | grep -o -P &#34;\d+\.\d+\.\d+\-\d+&#34; | sort -V | head -n -1)
latest=$(echo $vmlinuz | grep -o -P &#34;\d+\.\d+\.\d+\-\d+&#34; | sort -V | tail -n 1)

echo &#34;&gt;&gt; COPYING ${latest}-generic. LATEST VERSION.&#34;

for file in initrd.img vmlinuz; do
    cp &#34;/boot/${file}-${latest}-generic&#34; &#34;/boot/efi/EFI/ubuntu/${file}-generic&#34;
done
</code></pre></div><div class=post-info><div class="post-date dt-published">Oct 29, 2019</div><a class="post-hidden-url u-url" href=/2019/10/refind-an-elegant-bootloader/>/2019/10/refind-an-elegant-bootloader/</a>
<a href class="p-name p-author post-hidden-author h-card" rel=me>Manu</a><div class=post-taxonomies><ul class=post-categories><li><a href=/categories/guides/>guides</a></li></ul></div></div></article><div class="pagination post-pagination"><div class="left pagination-item"><a href=/2020/03/rich-content/>Rich Content</a></div><div class="right pagination-item"><a href=/2019/03/markdown-syntax-guide/>Markdown Syntax Guide</a></div></div></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>© Manu, 2022<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br></p></div><script>const STORAGE_KEY="user-color-scheme",defaultTheme="auto-without-switcher";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),switchButton&&(changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)),showContent()});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(e){e&&(e.textContent=currentTheme=="dark"?"Light theme":"Dark theme")}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}function showContent(){document.body.style.visibility="visible",document.body.style.opacity=1}</script></div><p class="h-card vcard"><a href='class="p-name' u-url url fn" rel=me>Manu</a></p></footer></div></body></html>